
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

#configure the system as a router
sysctl -w net.ipv4.ip_forward=1

#allow traffic from internal (LAN to DMZ)
iptables -t filter -A FORWARD -i "LAN1_name" -o "DMZ_name" -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
iptables -t filter -A FORWARD -i "DMZ_name" -o "LAN1_name" -m state --state ESTABLISHED,RELATED -j ACCEPT

#allow traffic from the internet (WAN to DMZ)
iptables -t filter -A FORWARD -i "WAN_name" -o "DMZ_name" -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
iptables -t filter -A FORWARD -i "DMZ_name" -o "WAN_name" -m state --state ESTABLISHED,RELATED -j ACCEPT

#redirect incoming web requests to web server through WAN firewall
iptables -t nat -A PREROUTING -p tcp -i "WAN_name" -d "WAN_ip" --dport 80 -j DNAT --to-dest 192.168.20.2
iptables -t nat -A PREROUTING -p tcp -i "WAN_name" -d "WAN_ip" --dport 443 -j DNAT --to-dest 192.168.20.2

#redirect incoming mail (SMTP requests) to mail server throuth WAN firewall
iptables -t nat -A PREROUTING -p tcp -i "WAN_name" -d "WAN_ip" --dport 25 -j DNAT --to-dest 192.168.20.3

#redirect incoming DNS requests to DNS server through WAN firewall
iptables -t nat -A PREROUTING -p udp -i "WAN_name" -d "WAN_ip" --dport 53 -j DNAT --to-dest 192.168.20.4
iptables -t nat -A PREROUTING -p tcp -i "WAN_name" -d "WAN_ip" --dport 53 -j DNAT --to-dest 192.168.20.4

